.TH RAR2FS 1 "v\ " "Thu, Jan 09, 2020" "User Commands"
.SH NAME
.B rar2fs
\- FUSE file system for reading RAR archives
.SH SYNOPSIS
.B rar2fs
[options] source target
.SH DESCRIPTION
.B rar2fs
is a FUSE based file system that can mount a
.I source
RAR archive/volume or a directory containing any number of RAR archives on
.I target
and access (read only) the contents as plain files/directories. Other files located in the
.I source
directory are handled transparently. Both compressed and non-compressed (store) archives/volumes are supported but full media seek support (aka. indexing) is only available for non-compressed plaintext archives. If a RAR volume is selected as
.I source
the file specified must be the first in the set.
.PP
Since
.B rar2fs
is non-interactive, passwords that are required to decrypt encrypted archives should be stored in a file with the same name
as the main archive/volume file but with a
.I .pwd
extension. It may also be prefixed with a dot
.B '.'
character to hide it from simple list operations in traditional UNIX style. The latter variant has less precedence than the former.
It is also possible to specify a password per archive using the
.I .rarconfig
file described below.
Be aware that a password must be stored in plaintext format and is thus not protected in any way from unauthorized access.
.PP
This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
.PP
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with this program. If not, see
.I <http://www.gnu.org/licenses/>
.br
.SH OPTIONS
Besides the standard FUSE options
.B rar2fs
accepts the following options that can be passed to the program.
.TP
.B \-\-seek-length=n
set number of volume files that are traversed in search for headers [0=All]
.PP
.RS
Normally the RAR specific header(s) describing the files contained in a volume is located in the first volume file. Providing a value of 1 here should thus be sufficient to cover most cases. The default is 0, meaning that the complete set of volumes files are searched for headers.
The lower the value (starting from 1) the faster the display of folders containing a lot of RAR volumes (or volumes with a lot of files) will become since the number of open/search/close requests can be reduced but with less chance that all files are found and displayed.
.PP
It is also possible to specify the seek length per archive using the
.I .rarconfig
file described below. This adds the possibility to find all files without any significant performance loss.
.RE
.TP
.B \-\-exclude="<file>[;<file>;...]"
.TP
.B \-\-exclude=<path>
exclude file filter
.PP
.RS
When file access is requested and the file can not be found on the local file system all RAR archives in target folder are also searched for it. Not until that last operation fails the file is considered missing. On some platforms certain files (eg. .lock files) are always accessed but are usually never to expect within a RAR archive.
Specifying this option will treat the listed files differently. If not found on local file system they will
.I never
be searched for in the local RAR archives. This dramatically decrease the folder load/display time during 'ls' like operations on such systems.
Each file in the list should be separated by a semi-colon
.B ';'
character.
.PP
It is also possible to use this option in such a way that it instead points to a file that lists the actual exclude filter. This is done by specifying an absolute file path (starting with '/') instead of a semi-colon separated list of file names. The file pointed to may contain more than one line but for each line files should be separated by a semi-colon
.B ';'
character.
.RE
.TP
.B \-\-no-smp
disable SMP support (bind to CPU #0)
.PP
.RS
Note that this option is only available on Linux based platforms with support for the
.I cpu_set_t
type (GNU extension).
.RE
.TP
.B \-\-save-eof
force creation of .r2i files (end-of-file chunk) [EXPERIMENTAL]
.PP
.RS
Index information is usually populated by the media player at the beginning of a playback session. Since the index table in most cases is stored at the end of the file, retrieving this information without the use of some post-processing is more or less impossible to perform in real-time for compressed/encrypted video streams. The
.B mkr2i
tool is intended to be used in such cases to make the index table available in a separate
.I .r2i
file.
.PP
Enabling this option will instead tell
.B rar2fs
to guess where the index information is located by analyzing the access pattern of the media player and then write the end-of-file chunk to an
.I .r2i
file automatically. This method is however less precise than when using the
.B mkr2i
tool. Expect an increase in size of the generated
.I .r2i
file compared to using the
.B mkr2i
tool directly. Start of playback will also be delayed since almost the entire archive needs to be extracted in order to access the data towards the end of the file and make it available for playback.
.PP
This option is only supported for AVI 1.0 and multi-part OpenDML (AVI 2.0) files created by a properly configured muxer. Badly configured muxers will expose themselves by generating invalid frame counts. The latter is automatically detected by
.BR rar2fs .
.PP
It is also possible to enable/disable this option per archive using the
.I .rarconfig
file described below.
.RE
.TP
.B \-\-no-lib-check
disable dynamic library consistency check
.PP
.RS
At startup
.B rar2fs
validates that the dynamic libraries
.I libfuse.so
and
.I libunrar.so
are compatible/consistent with what was used during compilation.
Use this option to by-pass this check. Use of this option is discouraged.
.RE
.TP
.B \-\-iob-size=n
tune the size of the I/O buffer
.PP
.RS
The I/O buffer is used to prefetch data at extraction of compressed or encrypted archives to make sure streaming is possible without delay due to disk or network I/O. Depending on the current system resources and network latency this buffer might need to be adjusted. A small buffer takes less resources but increase the chance that
.B rar2fs
must wait for data to arrive during a read request. On the other hand, a large buffer will increase memory footprint which may not always be desired. Also keep in mind that every file being extracted requires its own buffer. So the total memory resources required are always the buffer size multiplied by the number of active extraction threads. Be careful when choosing buffer size. There is no cap on the size itself. The only requirement is that it is a 'power of 2' Megabytes, eg. 1,2,4,8, etc. The default size is 4MiB.
.RE
.TP
.B \-\-hist-size=n
tune the size of I/O buffer history
.PP
.RS
The I/O buffer history is a sliding window within the I/O buffer that is guaranteed to never be overwritten until future data has been consumed passed this limit. This means that, even though an extraction process can never be reversed, this part of the buffer can still deliver "historic" data within this window (eg. skipping backwards during movie playback). The size of the history buffer is expressed as a percentage of the total I/O buffer size between 0% and 75%. Specifying 0 here will completely disable this function. The default size is 50% of the total I/O buffer size.
.RE
.TP
.B \-\-no-expand-cbr
disable support for comic book RAR archives
.PP
.RS
Default is to always expand comic book RAR archives. In the case that comic book readers are used that expect to find the original
.I .cbr
archive this option can be used to keep such files intact.
.RE
.TP
.B \-\-relatime
.TP
.B \-\-relatime-rar
update file access times relative to modify or change time
.PP
.RS
By default
.B rar2fs
adhere to whatever access time update scheme is dictated by the underlying host file system. Since the host file system is unaware of files inside RAR archives the effect on those files will be that of 'noatime'. To overcome this limitation the
.B \-\-relatime
option may be used.
See
.BR mount (8)
for a description of 'relatime' and other mount options related to timestamping.
.PP
Another issue with strictly relying on the host file system for timestamping is the effect on RAR volumes. Since reading
data from a RAR volume might not access all files, only parts of the volume will obtain an updated timestamp. Tools relying on access time to clean up and delete "old" data might get fooled deleting only a subset of the volume resulting in a corrupt archive. By using the
.B \-\-relatime-rar
option this problem is eliminated by making sure all files in a volume set is always updated on access. Note that the underlying host file system must be writable and user needs sufficient permissions for this option to have any effect.
.PP
Except from what is described above the
.B \-\-relatime-rar
option has the same effect as
.B \-\-relatime
which effectively means that both these options does not need to be specified. Using
.B \-\-relatime
makes sense only if updates of the source RAR files are not wanted for some reason. There is a slight overhead inflicted by using
.B \-\-relatime-rar
since in the case of large RAR volume archives a lot of files will need a new timestamp. The access time is updated only at first read access after a file was opened which means overhead should be almost negligible.
.RE
.TP
.B \-\-config=file
specify per archive configuration file
.PP
.RS
Use this file instead of the default
.I .rarconfig
that should be placed directly under the source folder.
Refer to
.I rarconfig.example
for an explanation of syntax and details on how this feature can be used.
.RE
.TP
.B \-\-date-rar
use file date/timestamp from main archive file
.PP
.RS
By default the dates/timestamps are collected from the meta data in the RAR archives.
Use this option to instead force all initial dates/timestamps to be set according to the main RAR archive file. For volumes this means the first file in the set. If the
.B \-\-relatime
and/or
.B  \-\-relatime-rar
options are used it might affect the result of this option after mount time.
.RE
.TP
.B \-\-no-inherit-perm
do not inherit file permission mode from archive
.PP
.RS
By default the file permission mode bits are inherited from whatever is stored in the archive. Sometimes this is not preferable.
This option can be used to instead set the permission mode bits based on file type and current file mode creation mask, see
.BR umask (1p).
Another option is to use the FUSE \fIumask\fR mount option.
The latter has the benefit of completely ignoring what ever the file system implementation sets but also has some caveats with respect to
directories versus regular files.
.RE
.TP
.B \-\-operation-timeout=n
set timeout for UnRAR operations in seconds (default: 30)
.PP
.RS
Limits the execution time of individual UnRAR library operations to prevent indefinite hangs
when processing malformed or malicious archives. A timeout of 0 disables this protection.
The default timeout of 30 seconds should be sufficient for most operations on valid archives.
.RE
.TP
.B \-\-max-volume-count=n
set maximum number of volume files to process (default: 1000)
.PP
.RS
Limits the number of RAR volume files that will be processed when collecting files from
a multi-volume archive. This prevents resource exhaustion from archives claiming an
unreasonable number of volumes. The default limit of 1000 volumes should be sufficient
for legitimate multi-volume archives.
.RE
.TP
.B \-\-max-archive-entries=n
set maximum number of archive entries to process (default: 10000)
.PP
.RS
Limits the number of file entries that will be processed when reading RAR archives.
This prevents resource exhaustion from archives claiming billions of files.
The default limit of 10000 entries should be sufficient for most legitimate archives.
.RE
.TP
.B \-\-recursive
enable recursive unpacking of nested RAR archives (default: disabled)
.PP
.RS
When enabled,
.B rar2fs
will automatically detect and transparently unpack RAR archives contained within other
RAR archives. This allows seamless access to deeply nested archive structures without
manual extraction. Nested files are presented at the same directory level as their
parent archive (transparent flat unpacking), simplifying navigation.
.PP
Without this flag, nested RAR files appear as regular files and must be manually
extracted. Enable this option only for trusted archives, as recursive unpacking
increases resource usage and attack surface.
.RE
.TP
.B \-\-recursion-depth=n
set maximum recursion depth for nested archives (default: 5, range: 1-10)
.PP
.RS
Limits how many levels of nested RAR archives will be unpacked. For example, with
a depth of 3, an archive structure like A.rar → B.rar → C.rar → D.rar will only
unpack through C.rar; D.rar will appear as a regular file.
.PP
The default depth of 5 levels handles most legitimate nested archive scenarios while
providing protection against recursion bombs. Lower values (1-3) improve performance
and reduce resource consumption. Higher values (6-10) may be needed for deeply nested
backup or archival structures but increase security risk.
.PP
This option has no effect when
.B \-\-recursive=no
is specified.
.RE
.TP
.B \-\-recursion-max-size=n
set maximum total decompression size in gigabytes (default: 10)
.PP
.RS
Limits the total amount of data that will be decompressed from nested RAR archives
during recursive unpacking. This prevents decompression bombs (maliciously crafted
archives that expand to consume all available disk space).
.PP
When this limit is exceeded during nested extraction,
.B rar2fs
will stop unpacking further nested archives and log a security event. Already-unpacked
data remains accessible. The default limit of 10GB is conservative and should be
sufficient for most media collections. Increase only when working with large,
trusted nested archive sets.
.PP
This option has no effect when
.B \-\-recursive=no
is specified.
.RE
.br
.SH FUSE TUNING OPTIONS
The following options control FUSE-level performance parameters (EP002 Phase 7).
These are advanced options; the defaults are optimized for immutable RAR archives.
.TP
.B \-\-fuse-max-write=BYTES
Set FUSE maximum write buffer size. Default: 1048576 (1MB).
Valid range: 4096-4194304 (4KB-4MB). Higher values improve
large file write performance but increase kernel memory usage.
.TP
.B \-\-fuse-max-readahead=BYTES
Set FUSE maximum readahead size. Default: 524288 (512KB).
Valid range: 0-2097152 (0-2MB). Higher values improve sequential
read performance for cached workloads. Set to 0 to disable.
.TP
.B \-\-fuse-entry-timeout=SECONDS
Directory entry cache timeout. Default: 600.0 (10 minutes).
Valid range: 0.0-3600.0. Since RAR archives are typically
immutable, high values (600-3600) are recommended for
production use. Use low values (0-60) if archives may be
replaced during mount.
.TP
.B \-\-fuse-attr-timeout=SECONDS
File attribute cache timeout. Default: 600.0 (10 minutes).
Valid range: 0.0-3600.0. Recommendations same as entry-timeout.
.TP
.B \-\-fuse-negative-timeout=SECONDS
Negative lookup cache timeout. Default: 60.0 (1 minute).
Valid range: 0.0-3600.0. Caches "file not found" results.
.TP
.B \-\-fuse-max-background=COUNT
Maximum pending background requests. Valid range: 1-100.
Default: kernel default (~12). Higher values may improve
async I/O throughput but consume more kernel memory.
.TP
.B \-\-fuse-congestion-threshold=COUNT
Kernel congestion threshold. Valid range: 1-100.
Default: kernel default (~9). Affects scheduler behavior
under high load.
.PP
.RS
.B FUSE Capability Toggles (Debugging):
The following flags disable FUSE3 performance capabilities.
These are debugging/compatibility options; all capabilities
are enabled by default.
.TP
.B \-\-fuse-no-async-read
Disable asynchronous read capability. May reduce performance.
.TP
.B \-\-fuse-no-splice-read
Disable splice read (zero-copy) capability. May reduce performance.
.TP
.B \-\-fuse-no-parallel-dirops
Disable parallel directory operations. May reduce concurrency.
.RE
.PP
.RS
.B Examples:
.PP
Optimal configuration for immutable video archives on virtiofs:
.PP
.nf
rar2fs --iob-size=8 --hist-size=75 \\
       --fuse-entry-timeout=3600 --fuse-attr-timeout=3600 \\
       /mnt/host/media /mnt/rar2fs
.fi
.PP
Expected benefits: +24% directory operations, +10-20% metadata
operations, +7-13% video seeking (vs default configuration).
.PP
Conservative configuration for dynamic scenarios (archives may be replaced):
.PP
.nf
rar2fs --fuse-entry-timeout=0 --fuse-attr-timeout=0 \\
       /source /mount
.fi
.PP
.B Recursive Unpacking Examples:
.PP
Basic usage with nested RAR archives:
.PP
.nf
rar2fs --recursive /path/to/archives /mnt/rar
ls /mnt/rar/
# Shows all files from nested RARs at same level as parent files
.fi
.PP
Example: TV show release with nested subtitles:
.PP
.nf
# Archive structure: TheWire.S01E01.rar contains:
#   - TheWire.S01E01.mkv
#   - Subtitles.rar (contains english.srt, spanish.srt)
#
# Mount with recursive unpacking enabled:
rar2fs --recursive /media/tv-shows /mnt/rar
cat /mnt/rar/english.srt
# Transparent access - no manual extraction needed
.fi
.PP
Advanced: Deep nesting with custom depth limit:
.PP
.nf
# Enable recursive unpacking with custom depth limit (3 levels)
rar2fs --recursive --recursion-depth=3 /archives /mnt/rar
.fi
.PP
Security: Mount untrusted archives without recursive unpacking:
.PP
.nf
# Mount untrusted archive without --recursive flag (safer)
rar2fs -d1 /downloads/untrusted.rar /mnt/rar
# Nested RARs appear as regular files, must be manually extracted
.fi
.PP
.B Tuning Guide:
.PP
For immutable RAR archives (typical use case):
.br
1. Use high FUSE cache timeouts (600-3600s) to minimize
metadata lookups. RAR archives don't change, so aggressive
caching is safe.
.br
2. Use optimized I/O buffers (--iob-size=8 --hist-size=75)
for best throughput.
.br
3. Use default FUSE buffer sizes (1MB write, 512KB readahead)
unless profiling shows specific bottlenecks.
.PP
Memory impact calculation:
.br
max_write × max_background = kernel memory consumption
.br
Example: 1MB × 12 = 12MB (default, safe)
.br
Example: 4MB × 100 = 400MB (high throughput, risky)
.RE
.br
.SH SECURITY CONSIDERATIONS
.PP
.B rar2fs
implements multiple security mechanisms to protect against malicious or malformed
archives, especially when recursive unpacking is enabled:
.TP
.B Cycle Detection
Prevents infinite recursion loops where archive A contains archive B which contains
archive A. Each archive is fingerprinted using FNV-1a hashing during extraction.
If a cycle is detected (same archive encountered twice in the recursion chain),
processing stops immediately and a security event is logged at debug level 1-2.
.TP
.B Depth Limits
Enforces maximum recursion depth (configurable via
.B \-\-recursion-depth
, default: 5 levels) to prevent stack exhaustion from deeply nested archive structures.
Archives beyond the depth limit appear as regular files. This protects against recursion
bombs designed to consume system resources through excessive nesting. Security events
are logged when depth limits are reached.
.TP
.B Size Limits
Enforces maximum total decompression size (configurable via
.B \-\-recursion-max-size
, default: 10GB) to prevent decompression bombs that expand to fill available disk space.
When the cumulative size of unpacked nested archives exceeds this limit, further unpacking
stops but already-extracted data remains accessible. Security events are logged at debug
level 1-2.
.TP
.B Path Sanitization
All file paths from nested archives are sanitized to prevent directory traversal attacks.
Absolute paths (e.g., /etc/passwd) and parent directory references (e.g., ../../../etc/passwd)
are stripped. Windows-style drive letters (e.g., C:\\Windows\\System32) are also removed.
Only the base filename is retained for security. Path sanitization events are logged at
debug level 2.
.TP
.B Security Event Logging
All security-relevant events (cycle detection, depth limit exceeded, size limit exceeded,
path sanitization) are logged when debug level is set to 1 or 2 via the
.B \-d
option. Use
.B \-d1
or
.B \-d2
when mounting untrusted archives to monitor security events.
.PP
.B Recommendations for Untrusted Archives:
.PP
When mounting RAR archives from untrusted sources, consider these precautions:
.PP
1. Do not enable recursive unpacking (omit
.B \-\-recursive
flag)
.br
2. Enable security logging:
.B \-d1
or
.B \-d2
.br
3. Use conservative depth limits:
.B \-\-recursion-depth=2
.br
4. Reduce size limits:
.B \-\-recursion-max-size=1
(1GB)
.br
5. Run in a sandboxed environment (container, VM, restricted user account)
.PP
For trusted archives (personal backups, verified media collections), the default settings
provide a good balance between functionality and security.
.br
.SH MOUNT OPTIONS
.RE
.TP
.B \-o locale=LOCALE
set the locale to be used for RAR file name character set conversion
.PP
.RS
Default is to set the current locale according to the \fILC_*/LC_CTYPE\fR environment variables.
The need for translation of e.g. RAR encoded file names requires that a locale is explicitly set by \fBrar2fs\fR.
Othwerwise it would default to the \fI"C"\fR locale, which is sufficient for file name stored as standard \fIASCII\fR, but would not
translate deterministically for \fIUNICODE\fR file names.
Since not all platforms have the possibility to manipulate environment variables directly, this mount option can be used to set a
specific locale to be applied in such character set conversions. The possible values that may be assigned to \fBlocale\fR can
easily be determined by the \fB`locale -a`\fR command.
.RE
.TP
.B \-o warmup
.TP
.B \-o warmup=THREADS
start background warmup of internal caches at mount time
.PP
.RS
There are use-cases in which it makes sense to trigger a background warmup of the internal caches.
This option only has an effect for folder style mounts. The default number of background workers started is 5.
This can be tweaked by assigning a new warmup value. A warmup value of 0 will disable the function which is
thus the same as not providing the option at all. On the other hand a too high number here might result in the
current system limit for number of open files to be reached and the warmup will fail.
The benefit of using this option compared to manually populating the caches
by issuing e.g. a recursive \fB`ls -R`\fR or \fB`find`\fR command is that the internal warmup will
operate directly on the source folder. This is a lot faster than going through the file system mount point which
is required for the other alternatives. For stacked file systems the warmup, if used on both primary and
secondary mounts simultaneously, will not perform optimally since file system accesses cannot be avoided
in this case. While the performance is still expected to be a lot better than when not using this option,
using it also on secondary mounts comes with a penalty highly depending on current setup.
.br
.SH "SEE ALSO"
.br
.BR mount (8),
.BR mount.fuse (8),
.BR fusermount (1)
.PP
Project home page
.I <https://hasse69.github.io/rar2fs/>
.SH AUTHOR
.br
.B Hans Beckerus
.br
.I \<hans.beckerus#AT#gmail.com\>

